<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Tasman Traverse</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src='csv2geojson.js'></script>
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>
  <style>
  .mapboxgl-popup {
  max-width: 400px;
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  }
  </style>
<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiY2xhcmtjYXJ0ZXIiLCJhIjoiY2p0MHpnaXBmMDNxNDQ5cGd5dXk2Mzh5eCJ9.Pqxx2YDY44GbuMmlIt1t-g';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/clarkcarter/cjt47ckbc3f8u1fmrox7uilg9', //stylesheet location
    center: [ 161.790582, -36.213924
], // starting position
    zoom: 3.94 // starting zoom
});

var dataUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSJHEq3YOJbEbwTR7xVuOJWoehmZAN7b0pwWXQ3kBYMm8S0VB0BVTkyyoYw52onHySJmQkmLE74EAvp/pub?gid=577896986&single=true&output=csv";

$(document).ready(function() {
    $.ajax({
        type: "GET",
        url: dataUrl,
        dataType: "text",
        success: function(csvData) {makeGeoJSON(csvData);}
     });
});

  function makeGeoJSON(csvData) {
    csv2geojson.csv2geojson(csvData, {
      latfield: 'latitude',
      lonfield: 'longitude',
      delimiter: ','
    }, function(err, data) {

      map.once('idle', function () {

        var color = "#ffffff";
        map.addLayer({
                "id": "park-volcanoes",
                "type": "circle",
                "source": {
                  'type': 'geojson',
                  'data': data
                },
                "paint": {
                    "circle-radius": 6,
                    "circle-color": color
                },
                "filter": ["==", "name", "clark"],
            });
         /* map.addLayer({
          'id': 'participants',
          'type': 'symbol',
          'source': {
          'type': 'geojson',
          'data': data
        },
          'layout': {
          "icon-image": "{icon}-15",
          "text-field": "{name}",
          "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
          "text-offset": [0, 0.6],
          "text-anchor": "top",
          },
          'paint': {

          },
          "properties": {
            "icon-color": "{color}"
          }
        }); */

        window.setTimeout(function() {
          var bounds = new mapboxgl.LngLatBounds();
          data.features.forEach(function(feature) {
          bounds.extend(feature.geometry.coordinates);
          });
          map.fitBounds(bounds, {
            padding: 100,
            speed: 0.2 });
        }, 3000);
      });

    console.log(data);
});
}


</script>

</body>
